{% extends "base.html" %}

{% block title %}Automation - Social Media Automation V2{% endblock %}
{% block page_title %}Automation Settings{% endblock %}

{% block content %}
<div class="page-header">
    <div class="page-header-left">
        <h2>Automation Settings</h2>
        <p>Configure automated posting schedules and rules</p>
    </div>
    <div class="page-header-right">
        <button class="btn btn-primary" data-modal="createScheduleModal">
            <i class="fas fa-plus"></i>
            Create Schedule
        </button>
        <button class="btn btn-success" data-action="start-automation">
            <i class="fas fa-play"></i>
            Start Automation
        </button>
        <button class="btn btn-danger" data-action="stop-automation" style="display: none;">
            <i class="fas fa-stop"></i>
            Stop Automation
        </button>
    </div>
</div>

<div class="automation-status mb-4">
    <div class="status-card">
        <div class="status-indicator" id="automationStatus">
            <div class="status-dot stopped"></div>
            <span>Automation Stopped</span>
        </div>
        <div class="status-info">
            <div class="status-item">
                <span class="label">Active Schedules:</span>
                <span class="value" id="activeSchedules">0</span>
            </div>
            <div class="status-item">
                <span class="label">Next Post:</span>
                <span class="value" id="nextPost">None scheduled</span>
            </div>
            <div class="status-item">
                <span class="label">Posts Today:</span>
                <span class="value" id="postsToday">0</span>
            </div>
        </div>
    </div>
</div>

<div class="tabs">
    <div class="tab-nav">
        <button class="tab-button active" data-tab="schedules">
            <i class="fas fa-calendar"></i>
            Schedules
        </button>
        <button class="tab-button" data-tab="rules">
            <i class="fas fa-cogs"></i>
            Rules
        </button>
        <button class="tab-button" data-tab="logs">
            <i class="fas fa-list"></i>
            Logs
        </button>
        <button class="tab-button" data-tab="settings">
            <i class="fas fa-sliders-h"></i>
            Settings
        </button>
    </div>
    
    <div class="tab-content active" id="schedules">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Posting Schedules</h3>
                <div class="card-actions">
                    <div class="search-box">
                        <input type="text" placeholder="Search schedules..." id="searchSchedules">
                        <i class="fas fa-search"></i>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div class="schedules-grid" id="schedulesGrid">
                    <div class="schedule-card">
                        <div class="schedule-header">
                            <div class="schedule-info">
                                <h4>Daily Marketing Tips</h4>
                                <p>Facebook & LinkedIn</p>
                            </div>
                            <div class="schedule-status">
                                <span class="badge badge-success">Active</span>
                            </div>
                        </div>
                        <div class="schedule-details">
                            <div class="schedule-time">
                                <i class="fas fa-clock"></i>
                                <span>Every day at 9:00 AM</span>
                            </div>
                            <div class="schedule-platforms">
                                <i class="fab fa-facebook text-primary"></i>
                                <i class="fab fa-linkedin text-info"></i>
                            </div>
                        </div>
                        <div class="schedule-stats">
                            <div class="stat">
                                <span class="stat-value">15</span>
                                <span class="stat-label">Posts</span>
                            </div>
                            <div class="stat">
                                <span class="stat-value">98%</span>
                                <span class="stat-label">Success</span>
                            </div>
                        </div>
                        <div class="schedule-actions">
                            <button class="btn btn-sm btn-outline" data-action="edit-schedule" data-id="1">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-outline" data-action="pause-schedule" data-id="1">
                                <i class="fas fa-pause"></i>
                            </button>
                            <button class="btn btn-sm btn-outline" data-action="delete" data-id="1" data-type="schedule">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="schedule-card">
                        <div class="schedule-header">
                            <div class="schedule-info">
                                <h4>Product Updates</h4>
                                <p>Instagram & Twitter</p>
                            </div>
                            <div class="schedule-status">
                                <span class="badge badge-warning">Paused</span>
                            </div>
                        </div>
                        <div class="schedule-details">
                            <div class="schedule-time">
                                <i class="fas fa-clock"></i>
                                <span>Mon, Wed, Fri at 2:00 PM</span>
                            </div>
                            <div class="schedule-platforms">
                                <i class="fab fa-instagram text-danger"></i>
                                <i class="fab fa-twitter text-info"></i>
                            </div>
                        </div>
                        <div class="schedule-stats">
                            <div class="stat">
                                <span class="stat-value">8</span>
                                <span class="stat-label">Posts</span>
                            </div>
                            <div class="stat">
                                <span class="stat-value">85%</span>
                                <span class="stat-label">Success</span>
                            </div>
                        </div>
                        <div class="schedule-actions">
                            <button class="btn btn-sm btn-outline" data-action="edit-schedule" data-id="2">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-success" data-action="resume-schedule" data-id="2">
                                <i class="fas fa-play"></i>
                            </button>
                            <button class="btn btn-sm btn-outline" data-action="delete" data-id="2" data-type="schedule">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="schedule-card">
                        <div class="schedule-header">
                            <div class="schedule-info">
                                <h4>Guest Blog Posts</h4>
                                <p>WordPress Sites</p>
                            </div>
                            <div class="schedule-status">
                                <span class="badge badge-info">Scheduled</span>
                            </div>
                        </div>
                        <div class="schedule-details">
                            <div class="schedule-time">
                                <i class="fas fa-clock"></i>
                                <span>Weekly on Sunday at 6:00 PM</span>
                            </div>
                            <div class="schedule-platforms">
                                <i class="fab fa-wordpress text-primary"></i>
                                <span class="platform-count">+3 sites</span>
                            </div>
                        </div>
                        <div class="schedule-stats">
                            <div class="stat">
                                <span class="stat-value">3</span>
                                <span class="stat-label">Posts</span>
                            </div>
                            <div class="stat">
                                <span class="stat-value">100%</span>
                                <span class="stat-label">Success</span>
                            </div>
                        </div>
                        <div class="schedule-actions">
                            <button class="btn btn-sm btn-outline" data-action="edit-schedule" data-id="3">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-outline" data-action="pause-schedule" data-id="3">
                                <i class="fas fa-pause"></i>
                            </button>
                            <button class="btn btn-sm btn-outline" data-action="delete" data-id="3" data-type="schedule">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="empty-state" id="emptySchedules" style="display: none;">
                    <div class="empty-icon">
                        <i class="fas fa-calendar"></i>
                    </div>
                    <h3>No Schedules Found</h3>
                    <p>Create your first automated posting schedule to get started.</p>
                    <button class="btn btn-primary" data-modal="createScheduleModal">
                        <i class="fas fa-plus"></i>
                        Create Schedule
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="tab-content" id="rules">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Automation Rules</h3>
                <button class="btn btn-primary" data-modal="createRuleModal">
                    <i class="fas fa-plus"></i>
                    Add Rule
                </button>
            </div>
            <div class="card-body">
                <div class="rules-list">
                    <div class="rule-item">
                        <div class="rule-header">
                            <div class="rule-info">
                                <h4>Content Length Optimization</h4>
                                <p>Automatically adjust content length based on platform</p>
                            </div>
                            <div class="rule-toggle">
                                <label class="switch">
                                    <input type="checkbox" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                        <div class="rule-details">
                            <div class="rule-condition">
                                <strong>Condition:</strong> When content exceeds platform limit
                            </div>
                            <div class="rule-action">
                                <strong>Action:</strong> Truncate and add "Read more" link
                            </div>
                        </div>
                    </div>
                    
                    <div class="rule-item">
                        <div class="rule-header">
                            <div class="rule-info">
                                <h4>Hashtag Auto-Generation</h4>
                                <p>Automatically add relevant hashtags to posts</p>
                            </div>
                            <div class="rule-toggle">
                                <label class="switch">
                                    <input type="checkbox" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                        <div class="rule-details">
                            <div class="rule-condition">
                                <strong>Condition:</strong> When posting to Instagram or Twitter
                            </div>
                            <div class="rule-action">
                                <strong>Action:</strong> Add 3-5 relevant hashtags using AI
                            </div>
                        </div>
                    </div>
                    
                    <div class="rule-item">
                        <div class="rule-header">
                            <div class="rule-info">
                                <h4>Posting Time Optimization</h4>
                                <p>Post at optimal times based on audience activity</p>
                            </div>
                            <div class="rule-toggle">
                                <label class="switch">
                                    <input type="checkbox">
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                        <div class="rule-details">
                            <div class="rule-condition">
                                <strong>Condition:</strong> When scheduling posts
                            </div>
                            <div class="rule-action">
                                <strong>Action:</strong> Suggest optimal posting times
                            </div>
                        </div>
                    </div>
                    
                    <div class="rule-item">
                        <div class="rule-header">
                            <div class="rule-info">
                                <h4>Error Retry Logic</h4>
                                <p>Automatically retry failed posts with exponential backoff</p>
                            </div>
                            <div class="rule-toggle">
                                <label class="switch">
                                    <input type="checkbox" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                        <div class="rule-details">
                            <div class="rule-condition">
                                <strong>Condition:</strong> When post fails due to temporary error
                            </div>
                            <div class="rule-action">
                                <strong>Action:</strong> Retry up to 3 times with increasing delays
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="tab-content" id="logs">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Automation Logs</h3>
                <div class="card-actions">
                    <div class="dropdown">
                        <button class="btn btn-outline dropdown-toggle">
                            <i class="fas fa-filter"></i>
                            Filter
                        </button>
                        <div class="dropdown-menu">
                            <a href="#" data-filter="all">All Logs</a>
                            <a href="#" data-filter="success">Success</a>
                            <a href="#" data-filter="error">Errors</a>
                            <a href="#" data-filter="warning">Warnings</a>
                        </div>
                    </div>
                    <button class="btn btn-outline" data-action="export-logs">
                        <i class="fas fa-download"></i>
                        Export
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div class="logs-container">
                    <div class="log-item success">
                        <div class="log-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="log-content">
                            <div class="log-message">
                                Successfully posted "10 Marketing Tips" to Facebook
                            </div>
                            <div class="log-meta">
                                <span class="log-time">2 minutes ago</span>
                                <span class="log-schedule">Daily Marketing Tips</span>
                            </div>
                        </div>
                        <div class="log-actions">
                            <button class="btn btn-sm btn-outline" data-action="view-post">
                                <i class="fas fa-external-link-alt"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="log-item success">
                        <div class="log-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="log-content">
                            <div class="log-message">
                                Successfully posted "10 Marketing Tips" to LinkedIn
                            </div>
                            <div class="log-meta">
                                <span class="log-time">2 minutes ago</span>
                                <span class="log-schedule">Daily Marketing Tips</span>
                            </div>
                        </div>
                        <div class="log-actions">
                            <button class="btn btn-sm btn-outline" data-action="view-post">
                                <i class="fas fa-external-link-alt"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="log-item warning">
                        <div class="log-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="log-content">
                            <div class="log-message">
                                Content truncated for Twitter due to character limit
                            </div>
                            <div class="log-meta">
                                <span class="log-time">1 hour ago</span>
                                <span class="log-schedule">Product Updates</span>
                            </div>
                        </div>
                        <div class="log-actions">
                            <button class="btn btn-sm btn-outline" data-action="view-details">
                                <i class="fas fa-info-circle"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="log-item error">
                        <div class="log-icon">
                            <i class="fas fa-times-circle"></i>
                        </div>
                        <div class="log-content">
                            <div class="log-message">
                                Failed to post to Instagram: Authentication expired
                            </div>
                            <div class="log-meta">
                                <span class="log-time">3 hours ago</span>
                                <span class="log-schedule">Product Updates</span>
                            </div>
                        </div>
                        <div class="log-actions">
                            <button class="btn btn-sm btn-danger" data-action="retry-post">
                                <i class="fas fa-redo"></i>
                            </button>
                            <button class="btn btn-sm btn-outline" data-action="view-error">
                                <i class="fas fa-bug"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="log-item info">
                        <div class="log-icon">
                            <i class="fas fa-info-circle"></i>
                        </div>
                        <div class="log-content">
                            <div class="log-message">
                                Automation started with 3 active schedules
                            </div>
                            <div class="log-meta">
                                <span class="log-time">6 hours ago</span>
                                <span class="log-schedule">System</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="load-more-container">
                    <button class="btn btn-outline" data-action="load-more-logs">
                        <i class="fas fa-chevron-down"></i>
                        Load More Logs
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="tab-content" id="settings">
        <div class="settings-grid">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">General Settings</h3>
                </div>
                <div class="card-body">
                    <form id="generalSettingsForm" data-ajax>
                        <div class="form-group">
                            <label class="form-label">Automation Mode</label>
                            <select class="form-control" name="automation_mode">
                                <option value="automatic">Fully Automatic</option>
                                <option value="semi_automatic">Semi-Automatic (Require Approval)</option>
                                <option value="manual">Manual Only</option>
                            </select>
                            <div class="form-help">How automation should handle posting</div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Default Posting Interval (minutes)</label>
                            <input type="number" class="form-control" name="posting_interval" value="30" min="5" max="1440">
                            <div class="form-help">Minimum time between posts to avoid spam detection</div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Max Posts Per Day</label>
                            <input type="number" class="form-control" name="max_posts_per_day" value="10" min="1" max="50">
                            <div class="form-help">Maximum number of posts per day across all platforms</div>
                        </div>
                        
                        <div class="form-group">
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" name="enable_notifications" id="enableNotifications" checked>
                                <label class="form-check-label" for="enableNotifications">
                                    Enable email notifications
                                </label>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" name="auto_retry" id="autoRetry" checked>
                                <label class="form-check-label" for="autoRetry">
                                    Automatically retry failed posts
                                </label>
                            </div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i>
                            Save Settings
                        </button>
                    </form>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">AI Settings</h3>
                </div>
                <div class="card-body">
                    <form id="aiSettingsForm" data-ajax>
                        <div class="form-group">
                            <label class="form-label">Content Generation Model</label>
                            <select class="form-control" name="ai_model">
                                <option value="gpt-3.5-turbo">GPT-3.5 Turbo (Fast)</option>
                                <option value="gpt-4">GPT-4 (High Quality)</option>
                                <option value="gpt-4-turbo">GPT-4 Turbo (Balanced)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Default Content Tone</label>
                            <select class="form-control" name="default_tone">
                                <option value="professional">Professional</option>
                                <option value="casual">Casual</option>
                                <option value="friendly">Friendly</option>
                                <option value="formal">Formal</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" name="auto_hashtags" id="autoHashtags" checked>
                                <label class="form-check-label" for="autoHashtags">
                                    Automatically generate hashtags
                                </label>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" name="content_optimization" id="contentOptimization" checked>
                                <label class="form-check-label" for="contentOptimization">
                                    Optimize content for each platform
                                </label>
                            </div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i>
                            Save AI Settings
                        </button>
                    </form>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Security Settings</h3>
                </div>
                <div class="card-body">
                    <form id="securitySettingsForm" data-ajax>
                        <div class="form-group">
                            <label class="form-label">Rate Limiting</label>
                            <select class="form-control" name="rate_limiting">
                                <option value="conservative">Conservative (Safest)</option>
                                <option value="moderate">Moderate (Balanced)</option>
                                <option value="aggressive">Aggressive (Fastest)</option>
                            </select>
                            <div class="form-help">How aggressively to post to avoid platform restrictions</div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">User Agent Rotation</label>
                            <select class="form-control" name="user_agent_rotation">
                                <option value="enabled">Enabled</option>
                                <option value="disabled">Disabled</option>
                            </select>
                            <div class="form-help">Rotate browser user agents to avoid detection</div>
                        </div>
                        
                        <div class="form-group">
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" name="proxy_support" id="proxySupport">
                                <label class="form-check-label" for="proxySupport">
                                    Enable proxy support
                                </label>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" name="human_behavior" id="humanBehavior" checked>
                                <label class="form-check-label" for="humanBehavior">
                                    Simulate human behavior
                                </label>
                            </div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i>
                            Save Security Settings
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block modals %}
<div class="modal" id="createScheduleModal">
    <div class="modal-backdrop"></div>
    <div class="modal-content" style="max-width: 800px;">
        <div class="modal-header">
            <h3>Create Posting Schedule</h3>
            <button class="modal-close">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <form id="createScheduleForm" data-ajax>
                <div class="form-group">
                    <label class="form-label">Schedule Name</label>
                    <input type="text" class="form-control" name="name" placeholder="e.g., Daily Marketing Tips" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea class="form-control" name="description" rows="2" placeholder="Brief description of this schedule"></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Platforms</label>
                    <div class="platform-checkboxes">
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" name="platforms" value="facebook" id="platformFacebook">
                            <label class="form-check-label" for="platformFacebook">
                                <i class="fab fa-facebook text-primary"></i>
                                Facebook
                            </label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" name="platforms" value="instagram" id="platformInstagram">
                            <label class="form-check-label" for="platformInstagram">
                                <i class="fab fa-instagram text-danger"></i>
                                Instagram
                            </label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" name="platforms" value="twitter" id="platformTwitter">
                            <label class="form-check-label" for="platformTwitter">
                                <i class="fab fa-twitter text-info"></i>
                                Twitter
                            </label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" name="platforms" value="linkedin" id="platformLinkedin">
                            <label class="form-check-label" for="platformLinkedin">
                                <i class="fab fa-linkedin text-info"></i>
                                LinkedIn
                            </label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" name="platforms" value="guest_post" id="platformGuestPost">
                            <label class="form-check-label" for="platformGuestPost">
                                <i class="fab fa-wordpress text-primary"></i>
                                Guest Posts
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Schedule Type</label>
                    <select class="form-control" name="schedule_type" id="scheduleType" required>
                        <option value="">Select Schedule Type</option>
                        <option value="daily">Daily</option>
                        <option value="weekly">Weekly</option>
                        <option value="monthly">Monthly</option>
                        <option value="custom">Custom</option>
                    </select>
                </div>
                
                <div class="form-group" id="dailyOptions" style="display: none;">
                    <label class="form-label">Time</label>
                    <input type="time" class="form-control" name="daily_time">
                </div>
                
                <div class="form-group" id="weeklyOptions" style="display: none;">
                    <label class="form-label">Days of Week</label>
                    <div class="day-checkboxes">
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" name="weekly_days" value="monday" id="dayMonday">
                            <label class="form-check-label" for="dayMonday">Mon</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" name="weekly_days" value="tuesday" id="dayTuesday">
                            <label class="form-check-label" for="dayTuesday">Tue</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" name="weekly_days" value="wednesday" id="dayWednesday">
                            <label class="form-check-label" for="dayWednesday">Wed</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" name="weekly_days" value="thursday" id="dayThursday">
                            <label class="form-check-label" for="dayThursday">Thu</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" name="weekly_days" value="friday" id="dayFriday">
                            <label class="form-check-label" for="dayFriday">Fri</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" name="weekly_days" value="saturday" id="daySaturday">
                            <label class="form-check-label" for="daySaturday">Sat</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" name="weekly_days" value="sunday" id="daySunday">
                            <label class="form-check-label" for="daySunday">Sun</label>
                        </div>
                    </div>
                    <input type="time" class="form-control" name="weekly_time" placeholder="Time">
                </div>
                
                <div class="form-group" id="monthlyOptions" style="display: none;">
                    <label class="form-label">Day of Month</label>
                    <input type="number" class="form-control" name="monthly_day" min="1" max="31" placeholder="Day (1-31)">
                    <input type="time" class="form-control" name="monthly_time" placeholder="Time">
                </div>
                
                <div class="form-group" id="customOptions" style="display: none;">
                    <label class="form-label">Cron Expression</label>
                    <input type="text" class="form-control" name="cron_expression" placeholder="0 9 * * 1-5">
                    <div class="form-help">Use cron syntax for custom schedules</div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Content Source</label>
                    <select class="form-control" name="content_source" required>
                        <option value="">Select Content Source</option>
                        <option value="ai_generated">AI Generated</option>
                        <option value="content_library">Content Library</option>
                        <option value="rss_feed">RSS Feed</option>
                        <option value="template">Template</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Content Template/Topic</label>
                    <textarea class="form-control" name="content_template" rows="3" placeholder="Template or topic for content generation"></textarea>
                    <div class="form-help">This will be used to generate content automatically</div>
                </div>
                
                <div class="form-group">
                    <div class="form-check">
                        <input type="checkbox" class="form-check-input" name="auto_start" id="autoStart" checked>
                        <label class="form-check-label" for="autoStart">
                            Start schedule immediately
                        </label>
                    </div>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary modal-close">Cancel</button>
            <button type="submit" form="createScheduleForm" class="btn btn-primary">
                <i class="fas fa-save"></i>
                Create Schedule
            </button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.modal {
    display: none; /* Menyembunyikan modal secara default */
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.5);
    align-items: center;
    justify-content: center;
}

.modal.active {
    display: flex; /* Class ini akan ditambahkan oleh JavaScript untuk menampilkan modal */
}

/* Styles for Automation Page */
.modal {
    display: none; /* Sembunyikan secara default */
    position: fixed; /* Tetap di posisi yang sama bahkan saat scroll */
    z-index: 1050; /* Tampil di atas semua elemen lain */
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow-y: auto; /* Aktifkan scroll jika kontennya panjang */
    /* Efek visual untuk memusatkan perhatian */
    display: flex;
    align-items: center;
    justify-content: center;
}

.modal-backdrop {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.6); /* Latar belakang gelap transparan */
    z-index: -1;
}

.modal-content {
    background: white;
    border-radius: var(--border-radius-lg);
    box-shadow: var(--shadow-xl);
    padding: 24px;
    position: relative;
    z-index: 1;
    width: 90%;
    max-height: 90vh;
    display: flex;
    flex-direction: column;
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-bottom: 16px;
    border-bottom: 1px solid var(--gray-200);
}

.modal-header h3 {
    margin: 0;
    font-size: 18px;
    font-weight: 600;
}

.modal-close {
    background: transparent;
    border: none;
    font-size: 24px;
    cursor: pointer;
    color: var(--gray-400);
}
.modal-close:hover {
    color: var(--gray-800);
}

.modal-body {
    padding-top: 20px;
    padding-bottom: 20px;
    overflow-y: auto; /* Scroll hanya pada bagian body modal */
}

.modal-footer {
    display: flex;
    justify-content: flex-end;
    gap: 12px;
    padding-top: 16px;
    border-top: 1px solid var(--gray-200);
}

.automation-status {
    background: white;
    border-radius: var(--border-radius-lg);
    border: 1px solid var(--gray-200);
}

.status-card {
    padding: 24px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.status-indicator {
    display: flex;
    align-items: center;
    gap: 12px;
    font-size: 18px;
    font-weight: 600;
}

.status-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    animation: pulse 2s infinite;
}

.status-dot.running {
    background: var(--success-color);
}

.status-dot.stopped {
    background: var(--gray-400);
    animation: none;
}

.status-dot.paused {
    background: var(--warning-color);
}

@keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.5; }
    100% { opacity: 1; }
}

.status-info {
    display: flex;
    gap: 32px;
}

.status-item {
    text-align: center;
}

.status-item .label {
    display: block;
    font-size: 14px;
    color: var(--gray-600);
    margin-bottom: 4px;
}

.status-item .value {
    display: block;
    font-size: 18px;
    font-weight: 600;
    color: var(--gray-900);
}

.schedules-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 24px;
}

.schedule-card {
    background: white;
    border: 1px solid var(--gray-200);
    border-radius: var(--border-radius-lg);
    padding: 20px;
    transition: var(--transition);
}

.schedule-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
}

.schedule-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 16px;
}

.schedule-info h4 {
    font-size: 16px;
    font-weight: 600;
    margin-bottom: 4px;
    color: var(--gray-900);
}

.schedule-info p {
    font-size: 14px;
    color: var(--gray-600);
    margin: 0;
}

.schedule-details {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
    padding: 12px;
    background: var(--gray-50);
    border-radius: var(--border-radius);
}

.schedule-time {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 14px;
    color: var(--gray-700);
}

.schedule-platforms {
    display: flex;
    gap: 8px;
    align-items: center;
}

.schedule-platforms i {
    font-size: 16px;
}

.platform-count {
    font-size: 12px;
    color: var(--gray-500);
}

.schedule-stats {
    display: flex;
    gap: 24px;
    margin-bottom: 16px;
}

.stat {
    text-align: center;
}

.stat-value {
    display: block;
    font-size: 20px;
    font-weight: 700;
    color: var(--gray-900);
}

.stat-label {
    display: block;
    font-size: 12px;
    color: var(--gray-500);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.schedule-actions {
    display: flex;
    gap: 8px;
    justify-content: center;
}

.rules-list {
    display: flex;
    flex-direction: column;
    gap: 16px;
}

.rule-item {
    background: white;
    border: 1px solid var(--gray-200);
    border-radius: var(--border-radius);
    padding: 20px;
}

.rule-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 12px;
}

.rule-info h4 {
    font-size: 16px;
    font-weight: 600;
    margin-bottom: 4px;
    color: var(--gray-900);
}

.rule-info p {
    font-size: 14px;
    color: var(--gray-600);
    margin: 0;
}

.rule-toggle .switch {
    position: relative;
    display: inline-block;
    width: 48px;
    height: 24px;
}

.rule-toggle .switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.rule-toggle .slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: var(--gray-300);
    transition: var(--transition);
    border-radius: 24px;
}

.rule-toggle .slider:before {
    position: absolute;
    content: "";
    height: 18px;
    width: 18px;
    left: 3px;
    bottom: 3px;
    background-color: white;
    transition: var(--transition);
    border-radius: 50%;
}

.rule-toggle input:checked + .slider {
    background-color: var(--primary-color);
}

.rule-toggle input:checked + .slider:before {
    transform: translateX(24px);
}

.rule-details {
    font-size: 14px;
    color: var(--gray-600);
}

.rule-condition,
.rule-action {
    margin-bottom: 8px;
}

.logs-container {
    max-height: 600px;
    overflow-y: auto;
}

.log-item {
    display: flex;
    align-items: flex-start;
    gap: 16px;
    padding: 16px;
    border-bottom: 1px solid var(--gray-200);
    transition: var(--transition);
}

.log-item:hover {
    background: var(--gray-50);
}

.log-item:last-child {
    border-bottom: none;
}

.log-icon {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.log-item.success .log-icon {
    background: rgba(34, 197, 94, 0.1);
    color: var(--success-color);
}

.log-item.error .log-icon {
    background: rgba(239, 68, 68, 0.1);
    color: var(--danger-color);
}

.log-item.warning .log-icon {
    background: rgba(245, 158, 11, 0.1);
    color: var(--warning-color);
}

.log-item.info .log-icon {
    background: rgba(59, 130, 246, 0.1);
    color: var(--info-color);
}

.log-content {
    flex: 1;
}

.log-message {
    font-size: 14px;
    color: var(--gray-900);
    margin-bottom: 4px;
}

.log-meta {
    display: flex;
    gap: 16px;
    font-size: 12px;
    color: var(--gray-500);
}

.log-actions {
    display: flex;
    gap: 8px;
}

.load-more-container {
    text-align: center;
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid var(--gray-200);
}

.settings-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 24px;
}

.platform-checkboxes,
.day-checkboxes {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 12px;
    margin-top: 8px;
}

.day-checkboxes {
    grid-template-columns: repeat(7, 1fr);
}

.day-checkboxes .form-check-label {
    text-align: center;
    padding: 8px;
    border: 1px solid var(--gray-300);
    border-radius: var(--border-radius);
    cursor: pointer;
    transition: var(--transition);
}

.day-checkboxes .form-check-input:checked + .form-check-label {
    background: var(--primary-color);
    color: white;
    border-color: var(--primary-color);
}

@media (max-width: 768px) {
    .status-card {
        flex-direction: column;
        gap: 20px;
        text-align: center;
    }
    
    .status-info {
        justify-content: center;
        gap: 20px;
    }
    
    .schedules-grid {
        grid-template-columns: 1fr;
    }
    
    .schedule-details {
        flex-direction: column;
        gap: 8px;
        text-align: center;
    }
    
    .schedule-stats {
        justify-content: center;
    }
    
    .settings-grid {
        grid-template-columns: 1fr;
    }
    
    .platform-checkboxes {
        grid-template-columns: 1fr;
    }
    
    .day-checkboxes {
        grid-template-columns: repeat(4, 1fr);
    }
}
</style>
{% endblock %}

{% block extra_js %}
<script>
// Automation page specific JavaScript
document.addEventListener('DOMContentLoaded', function() {
    loadAutomationStatus();
    loadSchedules();
    loadLogs();
    initTabs();
    initScheduleForm();
    initSettingsForms();
});

async function loadAutomationStatus() {
    try {
        const response = await fetch('/api/automation/status');
        const data = await response.json();
        
        updateAutomationStatus(data);
    } catch (error) {
        console.error('Error loading automation status:', error);
    }
}

function updateAutomationStatus(data) {
    const statusElement = document.getElementById('automationStatus');
    const statusDot = statusElement.querySelector('.status-dot');
    const statusText = statusElement.querySelector('span');
    
    const startBtn = document.querySelector('[data-action="start-automation"]');
    const stopBtn = document.querySelector('[data-action="stop-automation"]');
    
    if (data.running) {
        statusDot.className = 'status-dot running';
        statusText.textContent = 'Automation Running';
        startBtn.style.display = 'none';
        stopBtn.style.display = 'inline-flex';
    } else {
        statusDot.className = 'status-dot stopped';
        statusText.textContent = 'Automation Stopped';
        startBtn.style.display = 'inline-flex';
        stopBtn.style.display = 'none';
    }
    
    document.getElementById('activeSchedules').textContent = data.active_schedules || 0;
    document.getElementById('nextPost').textContent = data.next_post || 'None scheduled';
    document.getElementById('postsToday').textContent = data.posts_today || 0;
}

async function loadSchedules() {
    try {
        const response = await fetch('/api/automation/schedules');
        const data = await response.json();
        
        if (data.schedules && data.schedules.length > 0) {
            updateSchedulesGrid(data.schedules);
        } else {
            showEmptySchedulesState();
        }
    } catch (error) {
        console.error('Error loading schedules:', error);
        showEmptySchedulesState();
    }
}

function updateSchedulesGrid(schedules) {
    const grid = document.getElementById('schedulesGrid');
    const emptyState = document.getElementById('emptySchedules');
    
    if (schedules.length === 0) {
        grid.style.display = 'none';
        emptyState.style.display = 'block';
        return;
    }
    
    grid.style.display = 'grid';
    emptyState.style.display = 'none';
    
    grid.innerHTML = schedules.map(schedule => createScheduleCard(schedule)).join('');
}

function createScheduleCard(schedule) {
    return `
        <div class="schedule-card">
            <div class="schedule-header">
                <div class="schedule-info">
                    <h4>${schedule.name}</h4>
                    <p>${getPlatformNames(schedule.platforms)}</p>
                </div>
                <div class="schedule-status">
                    <span class="badge badge-${getScheduleStatusColor(schedule.status)}">${capitalizeFirst(schedule.status)}</span>
                </div>
            </div>
            <div class="schedule-details">
                <div class="schedule-time">
                    <i class="fas fa-clock"></i>
                    <span>${formatScheduleTime(schedule)}</span>
                </div>
                <div class="schedule-platforms">
                    ${getPlatformIcons(schedule.platforms)}
                </div>
            </div>
            <div class="schedule-stats">
                <div class="stat">
                    <span class="stat-value">${schedule.posts_count || 0}</span>
                    <span class="stat-label">Posts</span>
                </div>
                <div class="stat">
                    <span class="stat-value">${schedule.success_rate || 0}%</span>
                    <span class="stat-label">Success</span>
                </div>
            </div>
            <div class="schedule-actions">
                <button class="btn btn-sm btn-outline" data-action="edit-schedule" data-id="${schedule.id}">
                    <i class="fas fa-edit"></i>
                </button>
                ${getScheduleActionButton(schedule)}
                <button class="btn btn-sm btn-outline" data-action="delete" data-id="${schedule.id}" data-type="schedule">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </div>
    `;
}

function getScheduleStatusColor(status) {
    const colors = {
        'active': 'success',
        'paused': 'warning',
        'stopped': 'secondary',
        'scheduled': 'info'
    };
    return colors[status] || 'secondary';
}

function getPlatformNames(platforms) {
    if (!platforms) return 'No platforms';
    
    const names = platforms.map(p => capitalizeFirst(p)).join(', ');
    return names.length > 30 ? names.substring(0, 30) + '...' : names;
}

function getPlatformIcons(platforms) {
    if (!platforms) return '';
    
    const iconMap = {
        'facebook': 'fab fa-facebook text-primary',
        'instagram': 'fab fa-instagram text-danger',
        'twitter': 'fab fa-twitter text-info',
        'linkedin': 'fab fa-linkedin text-info',
        'guest_post': 'fab fa-wordpress text-primary'
    };
    
    let icons = platforms.slice(0, 3).map(platform => 
        `<i class="${iconMap[platform] || 'fas fa-globe'}"></i>`
    ).join('');
    
    if (platforms.length > 3) {
        icons += `<span class="platform-count">+${platforms.length - 3} more</span>`;
    }
    
    return icons;
}

function formatScheduleTime(schedule) {
    if (schedule.schedule_type === 'daily') {
        return `Every day at ${schedule.time}`;
    } else if (schedule.schedule_type === 'weekly') {
        const days = schedule.days ? schedule.days.join(', ') : 'weekdays';
        return `${capitalizeFirst(days)} at ${schedule.time}`;
    } else if (schedule.schedule_type === 'monthly') {
        return `Monthly on day ${schedule.day} at ${schedule.time}`;
    } else {
        return schedule.cron_expression || 'Custom schedule';
    }
}

function getScheduleActionButton(schedule) {
    if (schedule.status === 'active') {
        return `
            <button class="btn btn-sm btn-outline" data-action="pause-schedule" data-id="${schedule.id}">
                <i class="fas fa-pause"></i>
            </button>
        `;
    } else if (schedule.status === 'paused') {
        return `
            <button class="btn btn-sm btn-success" data-action="resume-schedule" data-id="${schedule.id}">
                <i class="fas fa-play"></i>
            </button>
        `;
    } else {
        return `
            <button class="btn btn-sm btn-success" data-action="start-schedule" data-id="${schedule.id}">
                <i class="fas fa-play"></i>
            </button>
        `;
    }
}

function showEmptySchedulesState() {
    const grid = document.getElementById('schedulesGrid');
    const emptyState = document.getElementById('emptySchedules');
    
    grid.style.display = 'none';
    emptyState.style.display = 'block';
}

async function loadLogs() {
    try {
        const response = await fetch('/api/automation/logs');
        const data = await response.json();
        
        if (data.logs) {
            updateLogsContainer(data.logs);
        }
    } catch (error) {
        console.error('Error loading logs:', error);
    }
}

function updateLogsContainer(logs) {
    const container = document.querySelector('.logs-container');
    
    if (logs.length === 0) {
        container.innerHTML = `
            <div style="text-align: center; padding: 40px; color: var(--gray-500);">
                <i class="fas fa-list" style="font-size: 48px; margin-bottom: 16px; opacity: 0.5;"></i>
                <p>No logs found</p>
            </div>
        `;
        return;
    }
    
    container.innerHTML = logs.map(log => createLogItem(log)).join('');
}

function createLogItem(log) {
    return `
        <div class="log-item ${log.level}">
            <div class="log-icon">
                <i class="fas fa-${getLogIcon(log.level)}"></i>
            </div>
            <div class="log-content">
                <div class="log-message">${log.message}</div>
                <div class="log-meta">
                    <span class="log-time">${formatTimeAgo(log.timestamp)}</span>
                    <span class="log-schedule">${log.schedule_name || 'System'}</span>
                </div>
            </div>
            <div class="log-actions">
                ${getLogActions(log)}
            </div>
        </div>
    `;
}

function getLogIcon(level) {
    const icons = {
        'success': 'check-circle',
        'error': 'times-circle',
        'warning': 'exclamation-triangle',
        'info': 'info-circle'
    };
    return icons[level] || 'info-circle';
}

function getLogActions(log) {
    let actions = '';
    
    if (log.level === 'error' && log.retryable) {
        actions += `
            <button class="btn btn-sm btn-danger" data-action="retry-post" data-id="${log.id}">
                <i class="fas fa-redo"></i>
            </button>
        `;
    }
    
    if (log.post_url) {
        actions += `
            <button class="btn btn-sm btn-outline" data-action="view-post" data-url="${log.post_url}">
                <i class="fas fa-external-link-alt"></i>
            </button>
        `;
    }
    
    if (log.details) {
        actions += `
            <button class="btn btn-sm btn-outline" data-action="view-details" data-details="${encodeURIComponent(log.details)}">
                <i class="fas fa-info-circle"></i>
            </button>
        `;
    }
    
    return actions;
}

function initTabs() {
    const tabButtons = document.querySelectorAll('.tab-button');
    const tabContents = document.querySelectorAll('.tab-content');
    
    tabButtons.forEach(button => {
        button.addEventListener('click', function() {
            const targetTab = this.dataset.tab;
            
            // Update active states
            tabButtons.forEach(btn => btn.classList.remove('active'));
            tabContents.forEach(content => content.classList.remove('active'));
            
            this.classList.add('active');
            document.getElementById(targetTab).classList.add('active');
        });
    });
}

function initScheduleForm() {
    const scheduleTypeSelect = document.getElementById('scheduleType');
    const optionGroups = {
        'daily': document.getElementById('dailyOptions'),
        'weekly': document.getElementById('weeklyOptions'),
        'monthly': document.getElementById('monthlyOptions'),
        'custom': document.getElementById('customOptions')
    };
    
    if (scheduleTypeSelect) {
        scheduleTypeSelect.addEventListener('change', function() {
            // Hide all option groups
            Object.values(optionGroups).forEach(group => {
                if (group) group.style.display = 'none';
            });
            
            // Show selected option group
            const selectedGroup = optionGroups[this.value];
            if (selectedGroup) {
                selectedGroup.style.display = 'block';
            }
        });
    }
    
    // Handle form submission
    const createScheduleForm = document.getElementById('createScheduleForm');
    if (createScheduleForm) {
        createScheduleForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            await handleCreateSchedule(new FormData(this));
        });
    }
}

async function handleCreateSchedule(formData) {
    try {
        window.app.showLoading();
        
        const response = await fetch('/api/automation/schedules', {
            method: 'POST',
            body: formData
        });
        
        const result = await response.json();
        
        if (result.success) {
            window.app.showToast('Success', 'Schedule created successfully!', 'success');
            window.app.closeModal('createScheduleModal');
            loadSchedules();
            loadAutomationStatus();
        } else {
            window.app.showToast('Error', result.message || 'Failed to create schedule', 'error');
        }
    } catch (error) {
        console.error('Error creating schedule:', error);
        window.app.showToast('Error', 'Failed to create schedule', 'error');
    } finally {
        window.app.hideLoading();
    }
}

function initSettingsForms() {
    const forms = ['generalSettingsForm', 'aiSettingsForm', 'securitySettingsForm'];
    
    forms.forEach(formId => {
        const form = document.getElementById(formId);
        if (form) {
            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                await handleSaveSettings(formId, new FormData(this));
            });
        }
    });
}

async function handleSaveSettings(formId, formData) {
    try {
        const settingsType = formId.replace('SettingsForm', '');
        
        const response = await fetch(`/api/automation/settings/${settingsType}`, {
            method: 'POST',
            body: formData
        });
        
        const result = await response.json();
        
        if (result.success) {
            window.app.showToast('Success', 'Settings saved successfully!', 'success');
        } else {
            window.app.showToast('Error', result.message || 'Failed to save settings', 'error');
        }
    } catch (error) {
        console.error('Error saving settings:', error);
        window.app.showToast('Error', 'Failed to save settings', 'error');
    }
}

// Handle automation actions
document.addEventListener('click', function(e) {
    const action = e.target.closest('[data-action]');
    if (!action) return;
    
    const actionType = action.dataset.action;
    const itemId = action.dataset.id;
    
    switch (actionType) {
        case 'start-automation':
            startAutomation();
            break;
        case 'stop-automation':
            stopAutomation();
            break;
        case 'edit-schedule':
            editSchedule(itemId);
            break;
        case 'pause-schedule':
            pauseSchedule(itemId);
            break;
        case 'resume-schedule':
            resumeSchedule(itemId);
            break;
        case 'start-schedule':
            startSchedule(itemId);
            break;
        case 'retry-post':
            retryPost(itemId);
            break;
        case 'view-post':
            viewPost(action.dataset.url);
            break;
        case 'view-details':
            viewLogDetails(action.dataset.details);
            break;
        case 'load-more-logs':
            loadMoreLogs();
            break;
        case 'export-logs':
            exportLogs();
            break;
    }
});

async function startAutomation() {
    try {
        const response = await fetch('/api/automation/start', { method: 'POST' });
        const result = await response.json();
        
        if (result.success) {
            window.app.showToast('Success', 'Automation started successfully!', 'success');
            loadAutomationStatus();
        } else {
            window.app.showToast('Error', result.message || 'Failed to start automation', 'error');
        }
    } catch (error) {
        console.error('Error starting automation:', error);
        window.app.showToast('Error', 'Failed to start automation', 'error');
    }
}

async function stopAutomation() {
    try {
        const response = await fetch('/api/automation/stop', { method: 'POST' });
        const result = await response.json();
        
        if (result.success) {
            window.app.showToast('Success', 'Automation stopped successfully!', 'success');
            loadAutomationStatus();
        } else {
            window.app.showToast('Error', result.message || 'Failed to stop automation', 'error');
        }
    } catch (error) {
        console.error('Error stopping automation:', error);
        window.app.showToast('Error', 'Failed to stop automation', 'error');
    }
}

async function pauseSchedule(scheduleId) {
    try {
        const response = await fetch(`/api/automation/schedules/${scheduleId}/pause`, { method: 'POST' });
        const result = await response.json();
        
        if (result.success) {
            window.app.showToast('Success', 'Schedule paused successfully!', 'success');
            loadSchedules();
        } else {
            window.app.showToast('Error', result.message || 'Failed to pause schedule', 'error');
        }
    } catch (error) {
        console.error('Error pausing schedule:', error);
        window.app.showToast('Error', 'Failed to pause schedule', 'error');
    }
}

async function resumeSchedule(scheduleId) {
    try {
        const response = await fetch(`/api/automation/schedules/${scheduleId}/resume`, { method: 'POST' });
        const result = await response.json();
        
        if (result.success) {
            window.app.showToast('Success', 'Schedule resumed successfully!', 'success');
            loadSchedules();
        } else {
            window.app.showToast('Error', result.message || 'Failed to resume schedule', 'error');
        }
    } catch (error) {
        console.error('Error resuming schedule:', error);
        window.app.showToast('Error', 'Failed to resume schedule', 'error');
    }
}

function editSchedule(scheduleId) {
    // Open edit modal with schedule data
    console.log('Edit schedule:', scheduleId);
    // Implementation would load schedule data and open edit modal
}

function retryPost(logId) {
    // Retry failed post
    console.log('Retry post:', logId);
}

function viewPost(url) {
    if (url) {
        window.open(url, '_blank');
    }
}

function viewLogDetails(details) {
    if (details) {
        const decodedDetails = decodeURIComponent(details);
        alert(decodedDetails); // In a real app, this would be a proper modal
    }
}

function loadMoreLogs() {
    // Load more logs
    console.log('Load more logs');
}

function exportLogs() {
    // Export logs to file
    console.log('Export logs');
}

// Utility functions
function capitalizeFirst(str) {
    return str.charAt(0).toUpperCase() + str.slice(1);
}

function formatTimeAgo(dateString) {
    if (!dateString) return 'Unknown';
    
    const date = new Date(dateString);
    const now = new Date();
    const diffInSeconds = Math.floor((now - date) / 1000);

    if (diffInSeconds < 60) return 'Just now';
    if (diffInSeconds < 3600) return Math.floor(diffInSeconds / 60) + ' minutes ago';
    if (diffInSeconds < 86400) return Math.floor(diffInSeconds / 3600) + ' hours ago';
    if (diffInSeconds < 604800) return Math.floor(diffInSeconds / 86400) + ' days ago';
    return date.toLocaleDateString();
}
document.addEventListener('DOMContentLoaded', function() {
    // Logika untuk menampilkan dan menyembunyikan modal
    const modalTriggers = document.querySelectorAll('[data-modal]');
    
    modalTriggers.forEach(trigger => {
        trigger.addEventListener('click', () => {
            const modalId = trigger.getAttribute('data-modal');
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'flex'; // Tampilkan modal
            }
        });
    });

    const modalCloses = document.querySelectorAll('.modal-close, .modal-backdrop');
    modalCloses.forEach(close => {
        close.addEventListener('click', () => {
            const modal = close.closest('.modal');
            if (modal) {
                modal.style.display = 'none'; // Sembunyikan modal
            }
        });
    });

});

</script>
{% endblock %}