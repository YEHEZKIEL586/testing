{% extends "base.html" %}

{% block title %}Content Management - Social Media Automation V2{% endblock %}
{% block page_title %}Content Management{% endblock %}

{% block content %}
<!-- Header Actions -->
<div class="page-header">
    <div class="page-header-content">
        <div>
            <h1>Content Management</h1>
            <p>Create, edit, and manage your content with AI assistance</p>
        </div>
        <div class="page-actions">
            <button class="btn btn-primary" onclick="showCreateContentModal()">
                <i class="fas fa-plus"></i>
                Create Content
            </button>
            <button class="btn btn-secondary" onclick="showImportModal()">
                <i class="fas fa-upload"></i>
                Import Content
            </button>
            <button class="btn btn-info" onclick="showAIGeneratorModal()">
                <i class="fas fa-robot"></i>
                AI Generator
            </button>
        </div>
    </div>
</div>

<!-- Content Overview -->
<div class="stats-grid mb-4">
    <div class="stat-card">
        <div class="stat-card-header">
            <div class="stat-icon primary">
                <i class="fas fa-file-text"></i>
            </div>
        </div>
        <div class="stat-value" id="totalContent">0</div>
        <div class="stat-label">Total Content</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-card-header">
            <div class="stat-icon success">
                <i class="fas fa-check-circle"></i>
            </div>
        </div>
        <div class="stat-value" id="publishedContent">0</div>
        <div class="stat-label">Published</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-card-header">
            <div class="stat-icon warning">
                <i class="fas fa-edit"></i>
            </div>
        </div>
        <div class="stat-value" id="draftContent">0</div>
        <div class="stat-label">Drafts</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-card-header">
            <div class="stat-icon info">
                <i class="fas fa-robot"></i>
            </div>
        </div>
        <div class="stat-value" id="aiGeneratedContent">0</div>
        <div class="stat-label">AI Generated</div>
    </div>
</div>

<!-- Content Management -->
<div class="card">
    <div class="card-header">
        <h3 class="card-title">Content Library</h3>
        <div class="card-actions">
            <button class="btn btn-outline btn-sm" onclick="refreshContent()">
                <i class="fas fa-refresh"></i>
                Refresh
            </button>
            <button class="btn btn-outline btn-sm" onclick="exportContent()">
                <i class="fas fa-download"></i>
                Export
            </button>
        </div>
    </div>
    
    <div class="card-body">
        <!-- Search and Filters -->
        <div class="filters-container mb-4">
            <div class="search-container">
                <input type="text" id="searchContent" class="form-control" placeholder="Search content...">
                <i class="fas fa-search search-icon"></i>
            </div>
            
            <div class="filter-group">
                <select id="filterStatus" class="form-control">
                    <option value="">All Status</option>
                    <option value="draft">Draft</option>
                    <option value="published">Published</option>
                    <option value="scheduled">Scheduled</option>
                </select>
                
                <select id="filterType" class="form-control">
                    <option value="">All Types</option>
                    <option value="article">Article</option>
                    <option value="social_post">Social Post</option>
                    <option value="blog_post">Blog Post</option>
                    <option value="newsletter">Newsletter</option>
                </select>
                
                <select id="filterSource" class="form-control">
                    <option value="">All Sources</option>
                    <option value="manual">Manual</option>
                    <option value="ai_generated">AI Generated</option>
                    <option value="imported">Imported</option>
                </select>
                
                <button class="btn btn-outline" onclick="clearFilters()">
                    <i class="fas fa-times"></i>
                    Clear
                </button>
            </div>
        </div>
        
        <!-- Content Grid -->
        <div class="content-grid" id="contentGrid">
            <!-- Content cards will be loaded here -->
        </div>
        
        <!-- Loading State -->
        <div id="contentLoading" class="loading-state" style="display: none;">
            <div class="loading-spinner"></div>
            <p>Loading content...</p>
        </div>
        
        <!-- Empty State -->
        <div id="contentEmpty" class="empty-state" style="display: none;">
            <i class="fas fa-file-text"></i>
            <h3>No Content Found</h3>
            <p>You haven't created any content yet. Start by creating your first piece of content!</p>
            <button class="btn btn-primary" onclick="showCreateContentModal()">
                <i class="fas fa-plus"></i>
                Create First Content
            </button>
        </div>
    </div>
</div>

<!-- Create Content Modal -->
<div id="createContentModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 900px;">
        <div class="modal-header">
            <h2>Create New Content</h2>
            <button class="modal-close" onclick="closeCreateContentModal()">&times;</button>
        </div>
        
        <form id="createContentForm" class="modal-body">
            <div class="form-row">
                <div class="form-group">
                    <label for="contentTitle">Title</label>
                    <input type="text" id="contentTitle" name="title" class="form-control" placeholder="Enter content title" required>
                </div>
                
                <div class="form-group">
                    <label for="contentType">Content Type</label>
                    <select id="contentType" name="type" class="form-control" required>
                        <option value="">Select type...</option>
                        <option value="article">Article</option>
                        <option value="social_post">Social Media Post</option>
                        <option value="blog_post">Blog Post</option>
                        <option value="newsletter">Newsletter</option>
                    </select>
                </div>
            </div>
            
            <div class="form-group">
                <label for="contentDescription">Description/Summary</label>
                <textarea id="contentDescription" name="description" class="form-control" rows="3" placeholder="Brief description of the content"></textarea>
            </div>
            
            <!-- AI Generation Options -->
            <div class="form-group">
                <div class="ai-generation-section">
                    <h4>
                        <i class="fas fa-robot"></i>
                        AI Content Generation
                    </h4>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="aiTopic">Topic/Keywords</label>
                            <input type="text" id="aiTopic" name="ai_topic" class="form-control" placeholder="e.g., digital marketing, social media trends">
                        </div>
                        
                        <div class="form-group">
                            <label for="aiTone">Tone</label>
                            <select id="aiTone" name="ai_tone" class="form-control">
                                <option value="professional">Professional</option>
                                <option value="casual">Casual</option>
                                <option value="friendly">Friendly</option>
                                <option value="authoritative">Authoritative</option>
                                <option value="creative">Creative</option>
                                <option value="humorous">Humorous</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="aiLength">Target Length</label>
                            <select id="aiLength" name="ai_length" class="form-control">
                                <option value="short">Short (100-300 words)</option>
                                <option value="medium">Medium (300-800 words)</option>
                                <option value="long">Long (800-1500 words)</option>
                                <option value="very_long">Very Long (1500+ words)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="aiAudience">Target Audience</label>
                            <input type="text" id="aiAudience" name="ai_audience" class="form-control" placeholder="e.g., business owners, millennials, tech enthusiasts">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <button type="button" class="btn btn-info" onclick="generateAIContent()">
                            <i class="fas fa-magic"></i>
                            Generate Content with AI
                        </button>
                        <button type="button" class="btn btn-outline" onclick="improveWithAI()">
                            <i class="fas fa-lightbulb"></i>
                            Improve with AI
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Content Editor -->
            <div class="form-group">
                <label for="contentBody">Content</label>
                <div class="editor-toolbar">
                    <button type="button" class="editor-btn" onclick="formatText('bold')" title="Bold">
                        <i class="fas fa-bold"></i>
                    </button>
                    <button type="button" class="editor-btn" onclick="formatText('italic')" title="Italic">
                        <i class="fas fa-italic"></i>
                    </button>
                    <button type="button" class="editor-btn" onclick="formatText('underline')" title="Underline">
                        <i class="fas fa-underline"></i>
                    </button>
                    <button type="button" class="editor-btn" onclick="formatText('insertUnorderedList')" title="Bullet List">
                        <i class="fas fa-list-ul"></i>
                    </button>
                    <button type="button" class="editor-btn" onclick="formatText('insertOrderedList')" title="Numbered List">
                        <i class="fas fa-list-ol"></i>
                    </button>
                    <button type="button" class="editor-btn" onclick="insertLink()" title="Insert Link">
                        <i class="fas fa-link"></i>
                    </button>
                    <button type="button" class="editor-btn" onclick="insertImage()" title="Insert Image">
                        <i class="fas fa-image"></i>
                    </button>
                </div>
                <div id="contentBody" class="content-editor" contenteditable="true" placeholder="Start writing your content here..."></div>
                <div class="editor-stats">
                    <span id="wordCount">0 words</span>
                    <span id="charCount">0 characters</span>
                </div>
            </div>
            
            <!-- SEO Settings -->
            <div class="form-group">
                <button type="button" class="btn btn-link" onclick="toggleSEOSettings()">
                    <i class="fas fa-search"></i>
                    SEO Settings
                </button>
            </div>
            
            <div id="seoSettings" style="display: none;">
                <div class="form-group">
                    <label for="metaDescription">Meta Description</label>
                    <textarea id="metaDescription" name="meta_description" class="form-control" rows="2" placeholder="Brief description for search engines (150-160 characters)" maxlength="160"></textarea>
                    <small class="form-text text-muted">
                        <span id="metaDescriptionCount">0</span>/160 characters
                    </small>
                </div>
                
                <div class="form-group">
                    <label for="keywords">Keywords</label>
                    <input type="text" id="keywords" name="keywords" class="form-control" placeholder="keyword1, keyword2, keyword3">
                </div>
                
                <div class="form-group">
                    <label for="tags">Tags</label>
                    <input type="text" id="tags" name="tags" class="form-control" placeholder="tag1, tag2, tag3">
                </div>
                
                <div class="form-group">
                    <label for="slug">URL Slug</label>
                    <input type="text" id="slug" name="slug" class="form-control" placeholder="url-friendly-title">
                </div>
            </div>
            
            <!-- Publishing Options -->
            <div class="form-group">
                <label for="contentStatus">Status</label>
                <select id="contentStatus" name="status" class="form-control">
                    <option value="draft">Draft</option>
                    <option value="published">Published</option>
                    <option value="scheduled">Scheduled</option>
                </select>
            </div>
            
            <div id="scheduleSettings" style="display: none;">
                <div class="form-group">
                    <label for="publishDate">Publish Date</label>
                    <input type="datetime-local" id="publishDate" name="publish_date" class="form-control">
                </div>
            </div>
        </form>
        
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" onclick="closeCreateContentModal()">Cancel</button>
            <button type="button" class="btn btn-outline" onclick="saveAsDraft()">Save as Draft</button>
            <button type="button" class="btn btn-primary" onclick="createContent()">Create Content</button>
        </div>
    </div>
</div>

<!-- Edit Content Modal -->
<div id="editContentModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 900px;">
        <div class="modal-header">
            <h2>Edit Content</h2>
            <button class="modal-close" onclick="closeEditContentModal()">&times;</button>
        </div>
        
        <form id="editContentForm" class="modal-body">
            <input type="hidden" id="editContentId" name="content_id">
            
            <div class="form-row">
                <div class="form-group">
                    <label for="editContentTitle">Title</label>
                    <input type="text" id="editContentTitle" name="title" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="editContentType">Content Type</label>
                    <select id="editContentType" name="type" class="form-control" required>
                        <option value="article">Article</option>
                        <option value="social_post">Social Media Post</option>
                        <option value="blog_post">Blog Post</option>
                        <option value="newsletter">Newsletter</option>
                    </select>
                </div>
            </div>
            
            <div class="form-group">
                <label for="editContentDescription">Description/Summary</label>
                <textarea id="editContentDescription" name="description" class="form-control" rows="3"></textarea>
            </div>
            
            <div class="form-group">
                <label for="editContentBody">Content</label>
                <div class="editor-toolbar">
                    <button type="button" class="editor-btn" onclick="formatEditText('bold')" title="Bold">
                        <i class="fas fa-bold"></i>
                    </button>
                    <button type="button" class="editor-btn" onclick="formatEditText('italic')" title="Italic">
                        <i class="fas fa-italic"></i>
                    </button>
                    <button type="button" class="editor-btn" onclick="formatEditText('underline')" title="Underline">
                        <i class="fas fa-underline"></i>
                    </button>
                    <button type="button" class="editor-btn" onclick="formatEditText('insertUnorderedList')" title="Bullet List">
                        <i class="fas fa-list-ul"></i>
                    </button>
                    <button type="button" class="editor-btn" onclick="formatEditText('insertOrderedList')" title="Numbered List">
                        <i class="fas fa-list-ol"></i>
                    </button>
                    <button type="button" class="editor-btn" onclick="insertEditLink()" title="Insert Link">
                        <i class="fas fa-link"></i>
                    </button>
                    <button type="button" class="editor-btn" onclick="insertEditImage()" title="Insert Image">
                        <i class="fas fa-image"></i>
                    </button>
                </div>
                <div id="editContentBody" class="content-editor" contenteditable="true"></div>
                <div class="editor-stats">
                    <span id="editWordCount">0 words</span>
                    <span id="editCharCount">0 characters</span>
                </div>
            </div>
            
            <div class="form-group">
                <label for="editContentStatus">Status</label>
                <select id="editContentStatus" name="status" class="form-control">
                    <option value="draft">Draft</option>
                    <option value="published">Published</option>
                    <option value="scheduled">Scheduled</option>
                </select>
            </div>
        </form>
        
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" onclick="closeEditContentModal()">Cancel</button>
            <button type="button" class="btn btn-info" onclick="improveEditContent()">
                <i class="fas fa-lightbulb"></i>
                Improve with AI
            </button>
            <button type="button" class="btn btn-primary" onclick="updateContent()">Update Content</button>
        </div>
    </div>
</div>

<!-- AI Generator Modal -->
<div id="aiGeneratorModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 700px;">
        <div class="modal-header">
            <h2>AI Content Generator</h2>
            <button class="modal-close" onclick="closeAIGeneratorModal()">&times;</button>
        </div>
        
        <div class="modal-body">
            <div class="ai-generator-form">
                <div class="form-group">
                    <label for="aiGenTopic">What do you want to write about?</label>
                    <input type="text" id="aiGenTopic" class="form-control" placeholder="e.g., Benefits of social media marketing for small businesses">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="aiGenType">Content Type</label>
                        <select id="aiGenType" class="form-control">
                            <option value="article">Article</option>
                            <option value="blog_post">Blog Post</option>
                            <option value="social_post">Social Media Post</option>
                            <option value="newsletter">Newsletter</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="aiGenTone">Tone</label>
                        <select id="aiGenTone" class="form-control">
                            <option value="professional">Professional</option>
                            <option value="casual">Casual</option>
                            <option value="friendly">Friendly</option>
                            <option value="authoritative">Authoritative</option>
                            <option value="creative">Creative</option>
                            <option value="humorous">Humorous</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="aiGenLength">Length</label>
                        <select id="aiGenLength" class="form-control">
                            <option value="short">Short (100-300 words)</option>
                            <option value="medium">Medium (300-800 words)</option>
                            <option value="long">Long (800-1500 words)</option>
                            <option value="very_long">Very Long (1500+ words)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="aiGenAudience">Target Audience</label>
                        <input type="text" id="aiGenAudience" class="form-control" placeholder="e.g., small business owners">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="aiGenKeywords">Keywords (optional)</label>
                    <input type="text" id="aiGenKeywords" class="form-control" placeholder="keyword1, keyword2, keyword3">
                </div>
                
                <div class="form-group">
                    <label for="aiGenInstructions">Additional Instructions (optional)</label>
                    <textarea id="aiGenInstructions" class="form-control" rows="3" placeholder="Any specific requirements or style preferences..."></textarea>
                </div>
            </div>
        </div>
        
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" onclick="closeAIGeneratorModal()">Cancel</button>
            <button type="button" class="btn btn-primary" onclick="generateStandaloneContent()">
                <i class="fas fa-magic"></i>
                Generate Content
            </button>
        </div>
    </div>
</div>

<!-- Import Content Modal -->
<div id="importModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 600px;">
        <div class="modal-header">
            <h2>Import Content</h2>
            <button class="modal-close" onclick="closeImportModal()">&times;</button>
        </div>
        
        <div class="modal-body">
            <div class="import-options">
                <div class="import-option" onclick="selectImportType('file')">
                    <i class="fas fa-file-upload"></i>
                    <h4>Upload File</h4>
                    <p>Import from CSV, TXT, or DOCX files</p>
                </div>
                
                <div class="import-option" onclick="selectImportType('url')">
                    <i class="fas fa-link"></i>
                    <h4>From URL</h4>
                    <p>Import content from a webpage or RSS feed</p>
                </div>
                
                <div class="import-option" onclick="selectImportType('paste')">
                    <i class="fas fa-paste"></i>
                    <h4>Paste Text</h4>
                    <p>Paste content directly from clipboard</p>
                </div>
            </div>
            
            <!-- File Import -->
            <div id="fileImport" class="import-section" style="display: none;">
                <div class="form-group">
                    <label for="importFile">Select File</label>
                    <input type="file" id="importFile" class="form-control" accept=".csv,.txt,.docx">
                </div>
            </div>
            
            <!-- URL Import -->
            <div id="urlImport" class="import-section" style="display: none;">
                <div class="form-group">
                    <label for="importUrl">URL</label>
                    <input type="url" id="importUrl" class="form-control" placeholder="https://example.com/article">
                </div>
            </div>
            
            <!-- Paste Import -->
            <div id="pasteImport" class="import-section" style="display: none;">
                <div class="form-group">
                    <label for="importText">Paste Content</label>
                    <textarea id="importText" class="form-control" rows="10" placeholder="Paste your content here..."></textarea>
                </div>
            </div>
        </div>
        
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" onclick="closeImportModal()">Cancel</button>
            <button type="button" class="btn btn-primary" onclick="importContent()">Import</button>
        </div>
    </div>
</div>

<!-- Content Preview Modal -->
<div id="contentPreviewModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 800px;">
        <div class="modal-header">
            <h2 id="previewTitle">Content Preview</h2>
            <button class="modal-close" onclick="closeContentPreviewModal()">&times;</button>
        </div>
        
        <div class="modal-body">
            <div id="previewContent">
                <!-- Content preview will be loaded here -->
            </div>
        </div>
        
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" onclick="closeContentPreviewModal()">Close</button>
            <button type="button" class="btn btn-primary" onclick="editFromPreview()">Edit Content</button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.page-header {
    margin-bottom: 32px;
}

.page-header-content {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 20px;
}

.page-header h1 {
    margin: 0 0 8px 0;
    font-size: 32px;
    font-weight: 700;
    color: var(--gray-900);
}

.page-header p {
    margin: 0;
    color: var(--gray-600);
    font-size: 16px;
}

.page-actions {
    display: flex;
    gap: 12px;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 24px;
    margin-bottom: 32px;
}

.stat-card {
    background: white;
    border-radius: 12px;
    padding: 24px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    border: 1px solid var(--gray-200);
}

.stat-card-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 16px;
}

.stat-icon {
    width: 48px;
    height: 48px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    color: white;
}

.stat-icon.primary {
    background: var(--primary-color);
}

.stat-icon.success {
    background: var(--success-color);
}

.stat-icon.warning {
    background: var(--warning-color);
}

.stat-icon.info {
    background: var(--info-color);
}

.stat-value {
    font-size: 32px;
    font-weight: 700;
    color: var(--gray-900);
    margin-bottom: 8px;
}

.stat-label {
    font-size: 14px;
    color: var(--gray-600);
    font-weight: 500;
}

.filters-container {
    display: flex;
    align-items: center;
    gap: 16px;
    flex-wrap: wrap;
}

.search-container {
    position: relative;
    flex: 1;
    min-width: 250px;
}

.search-container .search-icon {
    position: absolute;
    left: 12px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--gray-400);
}

.search-container input {
    padding-left: 40px;
}

.filter-group {
    display: flex;
    gap: 12px;
    align-items: center;
}

.filter-group select {
    min-width: 150px;
}

.content-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 24px;
}

.content-card {
    background: white;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    border: 1px solid var(--gray-200);
    transition: transform 0.2s, box-shadow 0.2s;
}

.content-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
}

.content-card-header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    margin-bottom: 12px;
}

.content-title {
    font-size: 18px;
    font-weight: 600;
    color: var(--gray-900);
    margin: 0 0 8px 0;
    line-height: 1.4;
}

.content-type {
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    background: var(--gray-100);
    color: var(--gray-700);
}

.content-type.article {
    background: var(--primary-color);
    color: white;
}

.content-type.social_post {
    background: var(--info-color);
    color: white;
}

.content-type.blog_post {
    background: var(--success-color);
    color: white;
}

.content-type.newsletter {
    background: var(--warning-color);
    color: white;
}

.content-description {
    color: var(--gray-600);
    font-size: 14px;
    line-height: 1.5;
    margin-bottom: 16px;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.content-meta {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 16px;
    font-size: 12px;
    color: var(--gray-500);
}

.content-status {
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
}

.content-status.draft {
    background: var(--gray-100);
    color: var(--gray-700);
}

.content-status.published {
    background: var(--success-color);
    color: white;
}

.content-status.scheduled {
    background: var(--warning-color);
    color: white;
}

.content-actions {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}

.content-actions .btn {
    padding: 6px 12px;
    font-size: 12px;
}

.ai-generation-section {
    background: var(--gray-50);
    border: 1px solid var(--gray-200);
    border-radius: 8px;
    padding: 20px;
    margin: 16px 0;
}

.ai-generation-section h4 {
    margin: 0 0 16px 0;
    color: var(--primary-color);
    display: flex;
    align-items: center;
    gap: 8px;
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
}

.editor-toolbar {
    display: flex;
    gap: 4px;
    margin-bottom: 8px;
    padding: 8px;
    background: var(--gray-50);
    border: 1px solid var(--gray-200);
    border-radius: 8px 8px 0 0;
    flex-wrap: wrap;
}

.editor-btn {
    padding: 6px 8px;
    border: none;
    background: transparent;
    border-radius: 4px;
    cursor: pointer;
    color: var(--gray-600);
    transition: background-color 0.2s;
}

.editor-btn:hover {
    background: var(--gray-200);
    color: var(--gray-900);
}

.editor-btn.active {
    background: var(--primary-color);
    color: white;
}

.content-editor {
    min-height: 300px;
    padding: 16px;
    border: 1px solid var(--gray-200);
    border-top: none;
    border-radius: 0 0 8px 8px;
    background: white;
    outline: none;
    line-height: 1.6;
    font-family: inherit;
}

.content-editor:empty:before {
    content: attr(placeholder);
    color: var(--gray-400);
}

.editor-stats {
    display: flex;
    justify-content: space-between;
    padding: 8px 16px;
    background: var(--gray-50);
    border: 1px solid var(--gray-200);
    border-top: none;
    border-radius: 0 0 8px 8px;
    font-size: 12px;
    color: var(--gray-600);
}

.import-options {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 16px;
    margin-bottom: 24px;
}

.import-option {
    text-align: center;
    padding: 24px 16px;
    border: 2px solid var(--gray-200);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s;
}

.import-option:hover {
    border-color: var(--primary-color);
    background: var(--gray-50);
}

.import-option.selected {
    border-color: var(--primary-color);
    background: var(--primary-color);
    color: white;
}

.import-option i {
    font-size: 32px;
    margin-bottom: 12px;
    display: block;
}

.import-option h4 {
    margin: 0 0 8px 0;
    font-size: 16px;
}

.import-option p {
    margin: 0;
    font-size: 12px;
    opacity: 0.8;
}

.import-section {
    border-top: 1px solid var(--gray-200);
    padding-top: 20px;
}

.ai-generator-form {
    background: var(--gray-50);
    padding: 20px;
    border-radius: 8px;
    border: 1px solid var(--gray-200);
}

.loading-state {
    text-align: center;
    padding: 60px 20px;
}

.loading-spinner {
    width: 40px;
    height: 40px;
    border: 4px solid var(--gray-200);
    border-top: 4px solid var(--primary-color);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 0 auto 16px;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.empty-state {
    text-align: center;
    padding: 60px 20px;
    color: var(--gray-500);
}

.empty-state i {
    font-size: 64px;
    margin-bottom: 16px;
    opacity: 0.5;
}

.empty-state h3 {
    margin: 0 0 8px 0;
    font-size: 24px;
    color: var(--gray-700);
}

.empty-state p {
    margin: 0 0 20px 0;
    font-size: 16px;
}

@media (max-width: 768px) {
    .page-header-content {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .page-actions {
        width: 100%;
        justify-content: stretch;
    }
    
    .page-actions .btn {
        flex: 1;
    }
    
    .stats-grid {
        grid-template-columns: 1fr;
    }
    
    .filters-container {
        flex-direction: column;
        align-items: stretch;
    }
    
    .filter-group {
        flex-wrap: wrap;
    }
    
    .filter-group select {
        min-width: auto;
        flex: 1;
    }
    
    .content-grid {
        grid-template-columns: 1fr;
    }
    
    .form-row {
        grid-template-columns: 1fr;
    }
    
    .import-options {
        grid-template-columns: 1fr;
    }
    
    .editor-toolbar {
        flex-wrap: wrap;
    }
    
    .content-actions {
        justify-content: center;
    }
}
</style>
{% endblock %}

{% block extra_js %}
<script>
// Content management variables
let allContent = [];
let filteredContent = [];
let selectedImportType = null;
let currentEditingId = null;

// Initialize content page
document.addEventListener('DOMContentLoaded', function() {
    loadContent();
    loadStats();
    setupEventListeners();
});

function setupEventListeners() {
    // Search functionality
    document.getElementById('searchContent').addEventListener('input', debounce(filterContent, 300));
    
    // Filter functionality
    document.getElementById('filterStatus').addEventListener('change', filterContent);
    document.getElementById('filterType').addEventListener('change', filterContent);
    document.getElementById('filterSource').addEventListener('change', filterContent);
    
    // Content status change handler
    document.getElementById('contentStatus').addEventListener('change', function() {
        const scheduleSettings = document.getElementById('scheduleSettings');
        scheduleSettings.style.display = this.value === 'scheduled' ? 'block' : 'none';
    });
    
    // Word count tracking
    document.getElementById('contentBody').addEventListener('input', updateWordCount);
    document.getElementById('editContentBody').addEventListener('input', updateEditWordCount);
    
    // Meta description character count
    document.getElementById('metaDescription').addEventListener('input', updateMetaDescriptionCount);
    
    // Auto-generate slug from title
    document.getElementById('contentTitle').addEventListener('input', function() {
        const slug = this.value.toLowerCase()
            .replace(/[^a-z0-9\s-]/g, '')
            .replace(/\s+/g, '-')
            .replace(/-+/g, '-')
            .trim('-');
        document.getElementById('slug').value = slug;
    });
}

async function loadContent() {
    showLoading();
    
    try {
        const response = await fetch('/api/content');
        const data = await response.json();
        
        if (data.success) {
            allContent = data.content || [];
            filteredContent = [...allContent];
            
            renderContent();
            
            if (allContent.length === 0) {
                showEmptyState();
            } else {
                hideEmptyState();
            }
        } else {
            showNotification(data.message || 'Error loading content', 'error');
            showEmptyState();
        }
    } catch (error) {
        console.error('Error loading content:', error);
        showNotification('Error loading content', 'error');
        showEmptyState();
    } finally {
        hideLoading();
    }
}

async function loadStats() {
    try {
        const response = await fetch('/api/content/stats');
        const data = await response.json();
        
        if (data.success) {
            const stats = data.stats;
            document.getElementById('totalContent').textContent = stats.total_content || 0;
            document.getElementById('publishedContent').textContent = stats.published_content || 0;
            document.getElementById('draftContent').textContent = stats.draft_content || 0;
            document.getElementById('aiGeneratedContent').textContent = stats.ai_generated_content || 0;
        }
    } catch (error) {
        console.error('Error loading stats:', error);
    }
}

function renderContent() {
    const grid = document.getElementById('contentGrid');
    grid.innerHTML = '';
    
    filteredContent.forEach(content => {
        const card = createContentCard(content);
        grid.appendChild(card);
    });
}

function createContentCard(content) {
    const card = document.createElement('div');
    card.className = 'content-card';
    
    // Format dates
    const createdDate = new Date(content.created_at).toLocaleDateString();
    const updatedDate = new Date(content.updated_at).toLocaleDateString();
    
    card.innerHTML = `
        <div class="content-card-header">
            <div>
                <h3 class="content-title">${content.title}</h3>
                <span class="content-type ${content.type}">${content.type.replace('_', ' ')}</span>
            </div>
        </div>
        
        <div class="content-description">
            ${content.description || 'No description available'}
        </div>
        
        <div class="content-meta">
            <span>Created: ${createdDate}</span>
            <span>Updated: ${updatedDate}</span>
        </div>
        
        <div class="content-meta">
            <span class="content-status ${content.status}">${content.status}</span>
            <span>${content.word_count || 0} words</span>
        </div>
        
        <div class="content-actions">
            <button class="btn btn-primary btn-sm" onclick="editContent(${content.id})" title="Edit">
                <i class="fas fa-edit"></i>
                Edit
            </button>
            <button class="btn btn-secondary btn-sm" onclick="viewContent(${content.id})" title="View">
                <i class="fas fa-eye"></i>
                View
            </button>
            <button class="btn btn-info btn-sm" onclick="duplicateContent(${content.id})" title="Duplicate">
                <i class="fas fa-copy"></i>
                Duplicate
            </button>
            <button class="btn btn-success btn-sm" onclick="publishContent(${content.id})" title="Publish">
                <i class="fas fa-share"></i>
                Publish
            </button>
            <button class="btn btn-danger btn-sm" onclick="deleteContent(${content.id})" title="Delete">
                <i class="fas fa-trash"></i>
                Delete
            </button>
        </div>
    `;
    
    return card;
}

function filterContent() {
    const searchTerm = document.getElementById('searchContent').value.toLowerCase();
    const statusFilter = document.getElementById('filterStatus').value;
    const typeFilter = document.getElementById('filterType').value;
    const sourceFilter = document.getElementById('filterSource').value;
    
    filteredContent = allContent.filter(content => {
        const matchesSearch = !searchTerm || 
            content.title.toLowerCase().includes(searchTerm) ||
            (content.description && content.description.toLowerCase().includes(searchTerm));
        
        const matchesStatus = !statusFilter || content.status === statusFilter;
        const matchesType = !typeFilter || content.type === typeFilter;
        const matchesSource = !sourceFilter || content.source === sourceFilter;
        
        return matchesSearch && matchesStatus && matchesType && matchesSource;
    });
    
    renderContent();
    
    if (filteredContent.length === 0) {
        showEmptyState();
    } else {
        hideEmptyState();
    }
}

function clearFilters() {
    document.getElementById('searchContent').value = '';
    document.getElementById('filterStatus').value = '';
    document.getElementById('filterType').value = '';
    document.getElementById('filterSource').value = '';
    
    filteredContent = [...allContent];
    renderContent();
    hideEmptyState();
}

// Modal functions
function showCreateContentModal() {
    document.getElementById('createContentModal').style.display = 'flex';
}

function closeCreateContentModal() {
    document.getElementById('createContentModal').style.display = 'none';
    document.getElementById('createContentForm').reset();
    document.getElementById('contentBody').innerHTML = '';
    document.getElementById('seoSettings').style.display = 'none';
    document.getElementById('scheduleSettings').style.display = 'none';
    updateWordCount();
}

function showAIGeneratorModal() {
    document.getElementById('aiGeneratorModal').style.display = 'flex';
}

function closeAIGeneratorModal() {
    document.getElementById('aiGeneratorModal').style.display = 'none';
    document.querySelector('.ai-generator-form').reset();
}

function showImportModal() {
    document.getElementById('importModal').style.display = 'flex';
}

function closeImportModal() {
    document.getElementById('importModal').style.display = 'none';
    selectedImportType = null;
    document.querySelectorAll('.import-option').forEach(el => el.classList.remove('selected'));
    document.querySelectorAll('.import-section').forEach(el => el.style.display = 'none');
}

function showContentPreviewModal(content) {
    document.getElementById('previewTitle').textContent = content.title;
    document.getElementById('previewContent').innerHTML = `
        <div class="preview-meta">
            <p><strong>Type:</strong> ${content.type}</p>
            <p><strong>Status:</strong> ${content.status}</p>
            <p><strong>Word Count:</strong> ${content.word_count || 0} words</p>
        </div>
        <div class="preview-body">
            ${content.content}
        </div>
    `;
    document.getElementById('contentPreviewModal').style.display = 'flex';
    currentEditingId = content.id;
}

function closeContentPreviewModal() {
    document.getElementById('contentPreviewModal').style.display = 'none';
    currentEditingId = null;
}

function editFromPreview() {
    if (currentEditingId) {
        closeContentPreviewModal();
        editContent(currentEditingId);
    }
}

function toggleSEOSettings() {
    const section = document.getElementById('seoSettings');
    const isVisible = section.style.display !== 'none';
    section.style.display = isVisible ? 'none' : 'block';
}

// AI Content Generation
async function generateAIContent() {
    const topic = document.getElementById('aiTopic').value;
    const tone = document.getElementById('aiTone').value;
    const length = document.getElementById('aiLength').value;
    const audience = document.getElementById('aiAudience').value;
    const contentType = document.getElementById('contentType').value;
    
    if (!topic) {
        showNotification('Please enter a topic for AI generation', 'warning');
        return;
    }
    
    try {
        showNotification('Generating content with AI...', 'info');
        
        const response = await fetch('/api/content/generate-ai', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                topic,
                tone,
                length,
                audience,
                content_type: contentType
            })
        });
        
        const data = await response.json();
        
        if (data.success) {
            document.getElementById('contentBody').innerHTML = data.content;
            
            // Auto-fill other fields if provided
            if (data.title && !document.getElementById('contentTitle').value) {
                document.getElementById('contentTitle').value = data.title;
            }
            if (data.description && !document.getElementById('contentDescription').value) {
                document.getElementById('contentDescription').value = data.description;
            }
            if (data.meta_description) {
                document.getElementById('metaDescription').value = data.meta_description;
            }
            if (data.keywords) {
                document.getElementById('keywords').value = data.keywords;
            }
            
            updateWordCount();
            showNotification('Content generated successfully!', 'success');
        } else {
            showNotification(data.message || 'Error generating content', 'error');
        }
    } catch (error) {
        console.error('Error generating content:', error);
        showNotification('Error generating content', 'error');
    }
}

async function generateStandaloneContent() {
    const topic = document.getElementById('aiGenTopic').value;
    const type = document.getElementById('aiGenType').value;
    const tone = document.getElementById('aiGenTone').value;
    const length = document.getElementById('aiGenLength').value;
    const audience = document.getElementById('aiGenAudience').value;
    const keywords = document.getElementById('aiGenKeywords').value;
    const instructions = document.getElementById('aiGenInstructions').value;
    
    if (!topic) {
        showNotification('Please enter a topic for AI generation', 'warning');
        return;
    }
    
    try {
        showNotification('Generating content with AI...', 'info');
        
        const response = await fetch('/api/content/generate-ai', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                topic,
                content_type: type,
                tone,
                length,
                audience,
                keywords,
                instructions
            })
        });
        
        const data = await response.json();
        
        if (data.success) {
            // Create new content with generated data
            const newContent = {
                title: data.title || topic,
                type: type,
                description: data.description || '',
                content: data.content,
                status: 'draft',
                source: 'ai_generated',
                meta_description: data.meta_description || '',
                keywords: data.keywords || keywords,
                tags: data.tags || ''
            };
            
            // Save the generated content
            const saveResponse = await fetch('/api/content', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(newContent)
            });
            
            const saveData = await saveResponse.json();
            
            if (saveData.success) {
                showNotification('Content generated and saved successfully!', 'success');
                closeAIGeneratorModal();
                loadContent();
                loadStats();
            } else {
                showNotification(saveData.message || 'Error saving generated content', 'error');
            }
        } else {
            showNotification(data.message || 'Error generating content', 'error');
        }
    } catch (error) {
        console.error('Error generating content:', error);
        showNotification('Error generating content', 'error');
    }
}

async function improveWithAI() {
    const currentContent = document.getElementById('contentBody').innerHTML;
    
    if (!currentContent || currentContent.trim() === '') {
        showNotification('Please add some content first', 'warning');
        return;
    }
    
    try {
        showNotification('Improving content with AI...', 'info');
        
        const response = await fetch('/api/content/improve-ai', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                content: currentContent,
                type: document.getElementById('contentType').value,
                tone: document.getElementById('aiTone').value
            })
        });
        
        const data = await response.json();
        
        if (data.success) {
            document.getElementById('contentBody').innerHTML = data.improved_content;
            updateWordCount();
            showNotification('Content improved successfully!', 'success');
        } else {
            showNotification(data.message || 'Error improving content', 'error');
        }
    } catch (error) {
        console.error('Error improving content:', error);
        showNotification('Error improving content', 'error');
    }
}

async function improveEditContent() {
    const currentContent = document.getElementById('editContentBody').innerHTML;
    
    if (!currentContent || currentContent.trim() === '') {
        showNotification('Please add some content first', 'warning');
        return;
    }
    
    try {
        showNotification('Improving content with AI...', 'info');
        
        const response = await fetch('/api/content/improve-ai', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                content: currentContent,
                type: document.getElementById('editContentType').value
            })
        });
        
        const data = await response.json();
        
        if (data.success) {
            document.getElementById('editContentBody').innerHTML = data.improved_content;
            updateEditWordCount();
            showNotification('Content improved successfully!', 'success');
        } else {
            showNotification(data.message || 'Error improving content', 'error');
        }
    } catch (error) {
        console.error('Error improving content:', error);
        showNotification('Error improving content', 'error');
    }
}

// Rich text editor functions
function formatText(command, value = null) {
    document.execCommand(command, false, value);
    document.getElementById('contentBody').focus();
    updateWordCount();
}

function formatEditText(command, value = null) {
    document.execCommand(command, false, value);
    document.getElementById('editContentBody').focus();
    updateEditWordCount();
}

function insertLink() {
    const url = prompt('Enter URL:');
    if (url) {
        formatText('createLink', url);
    }
}

function insertEditLink() {
    const url = prompt('Enter URL:');
    if (url) {
        formatEditText('createLink', url);
    }
}

function insertImage() {
    const url = prompt('Enter image URL:');
    if (url) {
        formatText('insertImage', url);
    }
}

function insertEditImage() {
    const url = prompt('Enter image URL:');
    if (url) {
        formatEditText('insertImage', url);
    }
}

// Word count functions
function updateWordCount() {
    const content = document.getElementById('contentBody').textContent || '';
    const words = content.trim() ? content.trim().split(/\s+/).length : 0;
    const chars = content.length;
    
    document.getElementById('wordCount').textContent = `${words} words`;
    document.getElementById('charCount').textContent = `${chars} characters`;
}

function updateEditWordCount() {
    const content = document.getElementById('editContentBody').textContent || '';
    const words = content.trim() ? content.trim().split(/\s+/).length : 0;
    const chars = content.length;
    
    document.getElementById('editWordCount').textContent = `${words} words`;
    document.getElementById('editCharCount').textContent = `${chars} characters`;
}

function updateMetaDescriptionCount() {
    const content = document.getElementById('metaDescription').value;
    document.getElementById('metaDescriptionCount').textContent = content.length;
}

// Content CRUD operations
async function saveAsDraft() {
    const formData = getContentFormData();
    formData.status = 'draft';
    
    try {
        const response = await fetch('/api/content', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(formData)
        });
        
        const data = await response.json();
        
        if (data.success) {
            showNotification('Content saved as draft!', 'success');
            closeCreateContentModal();
            loadContent();
            loadStats();
        } else {
            showNotification(data.message || 'Error saving content', 'error');
        }
    } catch (error) {
        console.error('Error saving content:', error);
        showNotification('Error saving content', 'error');
    }
}

async function createContent() {
    const formData = getContentFormData();
    
    try {
        const response = await fetch('/api/content', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(formData)
        });
        
        const data = await response.json();
        
        if (data.success) {
            showNotification('Content created successfully!', 'success');
            closeCreateContentModal();
            loadContent();
            loadStats();
        } else {
            showNotification(data.message || 'Error creating content', 'error');
        }
    } catch (error) {
        console.error('Error creating content:', error);
        showNotification('Error creating content', 'error');
    }
}

function getContentFormData() {
    const content = document.getElementById('contentBody').innerHTML;
    const wordCount = content ? content.replace(/<[^>]*>/g, '').trim().split(/\s+/).length : 0;
    
    return {
        title: document.getElementById('contentTitle').value,
        type: document.getElementById('contentType').value,
        description: document.getElementById('contentDescription').value,
        content: content,
        status: document.getElementById('contentStatus').value,
        publish_date: document.getElementById('publishDate').value,
        meta_description: document.getElementById('metaDescription').value,
        keywords: document.getElementById('keywords').value,
        tags: document.getElementById('tags').value,
        slug: document.getElementById('slug').value,
        word_count: wordCount,
        source: 'manual'
    };
}

async function editContent(contentId) {
    try {
        const response = await fetch(`/api/content/${contentId}`);
        const data = await response.json();
        
        if (data.success) {
            const content = data.content;
            
            // Populate edit form
            document.getElementById('editContentId').value = content.id;
            document.getElementById('editContentTitle').value = content.title;
            document.getElementById('editContentType').value = content.type;
            document.getElementById('editContentDescription').value = content.description || '';
            document.getElementById('editContentBody').innerHTML = content.content || '';
            document.getElementById('editContentStatus').value = content.status;
            
            updateEditWordCount();
            
            // Show modal
            document.getElementById('editContentModal').style.display = 'flex';
        } else {
            showNotification(data.message || 'Error loading content', 'error');
        }
    } catch (error) {
        console.error('Error loading content:', error);
        showNotification('Error loading content', 'error');
    }
}

function closeEditContentModal() {
    document.getElementById('editContentModal').style.display = 'none';
}

async function updateContent() {
    const contentId = document.getElementById('editContentId').value;
    const content = document.getElementById('editContentBody').innerHTML;
    const wordCount = content ? content.replace(/<[^>]*>/g, '').trim().split(/\s+/).length : 0;
    
    const formData = {
        title: document.getElementById('editContentTitle').value,
        type: document.getElementById('editContentType').value,
        description: document.getElementById('editContentDescription').value,
        content: content,
        status: document.getElementById('editContentStatus').value,
        word_count: wordCount
    };
    
    try {
        const response = await fetch(`/api/content/${contentId}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(formData)
        });
        
        const data = await response.json();
        
        if (data.success) {
            showNotification('Content updated successfully!', 'success');
            closeEditContentModal();
            loadContent();
        } else {
            showNotification(data.message || 'Error updating content', 'error');
        }
    } catch (error) {
        console.error('Error updating content:', error);
        showNotification('Error updating content', 'error');
    }
}

async function viewContent(contentId) {
    try {
        const response = await fetch(`/api/content/${contentId}`);
        const data = await response.json();
        
        if (data.success) {
            showContentPreviewModal(data.content);
        } else {
            showNotification(data.message || 'Error loading content', 'error');
        }
    } catch (error) {
        console.error('Error loading content:', error);
        showNotification('Error loading content', 'error');
    }
}

async function duplicateContent(contentId) {
    try {
        const response = await fetch(`/api/content/${contentId}/duplicate`, {
            method: 'POST'
        });
        
        const data = await response.json();
        
        if (data.success) {
            showNotification('Content duplicated successfully!', 'success');
            loadContent();
            loadStats();
        } else {
            showNotification(data.message || 'Error duplicating content', 'error');
        }
    } catch (error) {
        console.error('Error duplicating content:', error);
        showNotification('Error duplicating content', 'error');
    }
}

async function publishContent(contentId) {
    try {
        const response = await fetch(`/api/content/${contentId}/publish`, {
            method: 'POST'
        });
        
        const data = await response.json();
        
        if (data.success) {
            showNotification('Content published successfully!', 'success');
            loadContent();
            loadStats();
        } else {
            showNotification(data.message || 'Error publishing content', 'error');
        }
    } catch (error) {
        console.error('Error publishing content:', error);
        showNotification('Error publishing content', 'error');
    }
}

async function deleteContent(contentId) {
    if (!confirm('Are you sure you want to delete this content? This action cannot be undone.')) {
        return;
    }
    
    try {
        const response = await fetch(`/api/content/${contentId}`, {
            method: 'DELETE'
        });
        
        const data = await response.json();
        
        if (data.success) {
            showNotification('Content deleted successfully!', 'success');
            loadContent();
            loadStats();
        } else {
            showNotification(data.message || 'Error deleting content', 'error');
        }
    } catch (error) {
        console.error('Error deleting content:', error);
        showNotification('Error deleting content', 'error');
    }
}

// Import functionality
function selectImportType(type) {
    selectedImportType = type;
    
    // Update UI
    document.querySelectorAll('.import-option').forEach(el => el.classList.remove('selected'));
    event.currentTarget.classList.add('selected');
    
    // Show relevant section
    document.querySelectorAll('.import-section').forEach(el => el.style.display = 'none');
    document.getElementById(type + 'Import').style.display = 'block';
}

async function importContent() {
    if (!selectedImportType) {
        showNotification('Please select an import type', 'warning');
        return;
    }
    
    try {
        if (selectedImportType === 'file') {
            const file = document.getElementById('importFile').files[0];
            if (!file) {
                showNotification('Please select a file', 'warning');
                return;
            }
            
            const formData = new FormData();
            formData.append('file', file);
            
            const response = await fetch('/api/content/import/file', {
                method: 'POST',
                body: formData
            });
            
            const data = await response.json();
            if (data.success) {
                showNotification(`Imported ${data.imported_count} content items!`, 'success');
            } else {
                showNotification(data.message || 'Error importing file', 'error');
            }
        } else if (selectedImportType === 'url') {
            const url = document.getElementById('importUrl').value;
            if (!url) {
                showNotification('Please enter a URL', 'warning');
                return;
            }
            
            const response = await fetch('/api/content/import/url', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ url })
            });
            
            const data = await response.json();
            if (data.success) {
                showNotification('Content imported from URL!', 'success');
            } else {
                showNotification(data.message || 'Error importing from URL', 'error');
            }
        } else if (selectedImportType === 'paste') {
            const text = document.getElementById('importText').value;
            if (!text) {
                showNotification('Please paste some content', 'warning');
                return;
            }
            
            const response = await fetch('/api/content/import/text', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ text })
            });
            
            const data = await response.json();
            if (data.success) {
                showNotification('Content imported from text!', 'success');
            } else {
                showNotification(data.message || 'Error importing text', 'error');
            }
        }
        
        closeImportModal();
        loadContent();
        loadStats();
    } catch (error) {
        console.error('Error importing content:', error);
        showNotification('Error importing content', 'error');
    }
}

function refreshContent() {
    showNotification('Refreshing content...', 'info');
    loadContent();
    loadStats();
}

async function exportContent() {
    try {
        const response = await fetch('/api/content/export');
        const blob = await response.blob();
        
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `content_export_${new Date().toISOString().split('T')[0]}.csv`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);
        
        showNotification('Content exported successfully!', 'success');
    } catch (error) {
        console.error('Error exporting content:', error);
        showNotification('Error exporting content', 'error');
    }
}

// UI state functions
function showLoading() {
    document.getElementById('contentLoading').style.display = 'block';
    document.getElementById('contentGrid').style.display = 'none';
    document.getElementById('contentEmpty').style.display = 'none';
}

function hideLoading() {
    document.getElementById('contentLoading').style.display = 'none';
    document.getElementById('contentGrid').style.display = 'grid';
}

function showEmptyState() {
    document.getElementById('contentEmpty').style.display = 'block';
    document.getElementById('contentGrid').style.display = 'none';
}

function hideEmptyState() {
    document.getElementById('contentEmpty').style.display = 'none';
    document.getElementById('contentGrid').style.display = 'grid';
}

// Utility function for debouncing
function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

// Close modals when clicking outside
document.getElementById('createContentModal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeCreateContentModal();
    }
});

document.getElementById('editContentModal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeEditContentModal();
    }
});

document.getElementById('aiGeneratorModal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeAIGeneratorModal();
    }
});

document.getElementById('importModal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeImportModal();
    }
});

document.getElementById('contentPreviewModal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeContentPreviewModal();
    }
});

// Close modals with Escape key
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        if (document.getElementById('createContentModal').style.display === 'flex') {
            closeCreateContentModal();
        }
        if (document.getElementById('editContentModal').style.display === 'flex') {
            closeEditContentModal();
        }
        if (document.getElementById('aiGeneratorModal').style.display === 'flex') {
            closeAIGeneratorModal();
        }
        if (document.getElementById('importModal').style.display === 'flex') {
            closeImportModal();
        }
        if (document.getElementById('contentPreviewModal').style.display === 'flex') {
            closeContentPreviewModal();
        }
    }
});
</script>
{% endblock %}

